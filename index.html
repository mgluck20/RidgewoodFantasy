<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ridgewood Fantasy 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family:'Inter',sans-serif;
  background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
  color:#fff;
  min-height:100vh;
}
header {
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(10px);
  padding:2rem 1rem;
  text-align:center;
  border-bottom: 1px solid rgba(255,255,255,0.1);
  position:relative;
}
header h1 {
  font-size:2.5rem;
  font-weight:800;
  letter-spacing:-1px;
  background: linear-gradient(to right, #00d4ff, #00ffbb);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.sleeper-link {
  position:absolute;
  right:2rem;
  top:50%;
  transform:translateY(-50%);
  background: linear-gradient(135deg, #00d4ff 0%, #00ffbb 100%);
  color:#0f2027;
  padding:0.75rem 1.5rem;
  border-radius:12px;
  text-decoration:none;
  font-weight:700;
  font-size:0.9rem;
  transition: all 0.3s ease;
}
.sleeper-link:hover {
  transform:translateY(-50%) scale(1.05);
  box-shadow: 0 8px 20px rgba(0,212,255,0.4);
}
nav {
  display:flex;
  justify-content:center;
  gap:0.5rem;
  background: rgba(0,0,0,0.3);
  backdrop-filter: blur(10px);
  padding:1rem;
  flex-wrap:wrap;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
nav button {
  background: rgba(255,255,255,0.1);
  border:none;
  color:white;
  font-weight:600;
  cursor:pointer;
  font-size:0.9rem;
  padding:0.75rem 1.25rem;
  border-radius:12px;
  transition: all 0.3s ease;
}
nav button:hover {
  background: rgba(255,255,255,0.2);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
nav button.active {
  background: linear-gradient(135deg, #00d4ff 0%, #00ffbb 100%);
  color:#0f2027;
  box-shadow: 0 4px 15px rgba(0,212,255,0.4);
}
main {
  padding:2rem;
  max-width:1400px;
  margin:auto;
}
.section-title {
  font-size:1.8rem;
  margin-bottom:1.5rem;
  font-weight:700;
  display:flex;
  align-items:center;
  gap:0.5rem;
}
.section-title::before {
  content:'';
  width:4px;
  height:30px;
  background: linear-gradient(to bottom, #00d4ff, #00ffbb);
  border-radius:2px;
}
.card {
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(20px);
  border-radius:20px;
  padding:2rem;
  margin-bottom:2rem;
  border: 1px solid rgba(255,255,255,0.15);
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}
#winner-box {
  background: linear-gradient(135deg, #00d4ff 0%, #00ffbb 100%);
  color:#0f2027;
  padding:2rem;
  border-radius:20px;
  margin-bottom:2rem;
  font-weight:600;
  font-size:1.3rem;
  box-shadow: 0 8px 32px rgba(0,212,255,0.3);
  position:relative;
  overflow:hidden;
  display:flex;
  align-items:center;
  gap:1.5rem;
}
#winner-box::before {
  content:'üèÜ';
  position:absolute;
  right:20px;
  top:50%;
  transform:translateY(-50%);
  font-size:4rem;
  opacity:1;
}
.stats-grid {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap:1.5rem;
  margin-bottom:2rem;
}
.stat-card {
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(20px);
  border-radius:16px;
  padding:1.5rem;
  border: 1px solid rgba(255,255,255,0.15);
  text-align:center;
}
.stat-value {
  font-size:2.5rem;
  font-weight:800;
  background: linear-gradient(135deg, #00d4ff 0%, #00ffbb 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.stat-label {
  font-size:0.9rem;
  opacity:0.8;
  margin-top:0.5rem;
  font-weight:500;
}
table { width:100%; border-collapse:separate; border-spacing:0; font-size:0.95rem; }
table th, table td { padding:1rem; text-align:left; }
table th {
  background: rgba(255,255,255,0.12);
  color:white;
  cursor:pointer;
  user-select:none;
  font-weight:600;
  text-transform:uppercase;
  font-size:0.85rem;
  letter-spacing:0.5px;
  border-bottom: 2px solid rgba(0,212,255,0.5);
  position:sticky;
  top:0;
  z-index:10;
}
table tbody tr { background: rgba(255,255,255,0.04); transition: all 0.2s ease; }
table tbody tr:hover { background: rgba(255,255,255,0.12); transform: scale(1.01); }
table tbody tr td { border-bottom: 1px solid rgba(255,255,255,0.08); }
.rank-badge {
  display:inline-block;
  width:32px;
  height:32px;
  border-radius:50%;
  background: linear-gradient(135deg, #00d4ff 0%, #00ffbb 100%);
  text-align:center;
  line-height:32px;
  font-weight:700;
  font-size:0.9rem;
  color:#0f2027;
}
.rank-1 { background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); color:#000; }
.rank-2 { background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%); color:#000; }
.rank-3 { background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%); }
.team-logo {
  width:40px;
  height:40px;
  border-radius:50%;
  background: linear-gradient(135deg, #00d4ff 0%, #00ffbb 100%);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  font-size:1.2rem;
  margin-right:0.75rem;
  vertical-align:middle;
  border: 2px solid rgba(255,255,255,0.3);
  color:#0f2027;
}
.team-cell {
  display:flex;
  align-items:center;
  gap:0.75rem;
}
.team-info {
  display:flex;
  flex-direction:column;
}
.team-name { font-weight:600; font-size:1rem; }
.owner-name { font-size:0.85rem; opacity:0.7; }
.filter-container {
  margin-bottom:1.5rem;
  display:flex;
  gap:1rem;
  align-items:center;
  flex-wrap:wrap;
}
.filter-container select {
  padding:0.75rem 1rem;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.3);
  border-radius:10px;
  color:white;
  font-weight:500;
  cursor:pointer;
}
.transaction-badge {
  display:inline-block;
  padding:0.6rem 1rem;
  border-radius:8px;
  font-size:1rem;
  font-weight:600;
  text-transform:uppercase;
}
.transaction-trade { background: rgba(255, 165, 0, 0.3); color:#ffa500; }
.transaction-free_agent, .transaction-waiver { background: rgba(0, 255, 187, 0.3); color:#00ffbb; }
#last-updated {
  text-align:center;
  padding:1rem;
  opacity:0.6;
  font-size:0.9rem;
  margin-top:2rem;
}
#debug-info {
  margin-top:2rem;
  padding:1rem;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(10px);
  border:1px solid rgba(255,255,255,0.2);
  border-radius:12px;
  font-family:monospace;
  font-size:0.8rem;
  white-space:pre-wrap;
  max-height:400px;
  overflow-y:auto;
}
.playoff-container {
  display: flex;
  flex-direction: column;
  gap: 4rem;
  margin-top: 2rem;
}
.playoff-section {
  text-align: center;
}
.playoff-section h2 {
  font-size: 2.2rem;
  margin-bottom: 2rem;
  color: #00d4ff;
}
.playoff-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 2rem;
  justify-items: center;
}
.matchup-box {
  background: rgba(255,255,255,0.08);
  backdrop-filter: blur(20px);
  border-radius: 16px;
  padding: 1.5rem;
  width: 320px;
  border: 2px solid rgba(255,255,255,0.2);
  box-shadow: 0 8px 32px rgba(0,0,0,0.4);
}
.matchup-box.winner-border {
  border-color: #00ffbb;
}
.matchup-box.champ {
  transform: scale(1.15);
  border-width: 4px;
}
.matchup-team {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}
.matchup-team.win {
  opacity: 1;
}
.matchup-team.loss {
  opacity: 0.6;
}
.vs {
  text-align: center;
  font-size: 1.4rem;
  opacity: 0.8;
  margin: 1rem 0;
}
.champion-banner {
  padding: 2rem;
  background: linear-gradient(135deg, #FFD700, #FFA500);
  color: #000;
  border-radius: 20px;
  text-align: center;
  font-size: 2.5rem;
  font-weight: 800;
  box-shadow: 0 12px 40px rgba(255,212,0,0.5);
}
.playoff-message {
  text-align: center;
  padding: 4rem 2rem;
  font-size: 1.8rem;
  opacity: 0.8;
}
@media (max-width: 768px) {
  header h1 { font-size:1.8rem; }
  .sleeper-link { position:static; transform:none; margin-top:1rem; display:inline-block; }
  .playoff-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
<header>
  <h1>‚ö° Ridgewood Fantasy 2026 ‚ö°</h1>
  <a href="https://sleeper.com/leagues/1127785690072428544" target="_blank" class="sleeper-link">Open in Sleeper</a>
</header>
<nav>
  <button onclick="showPage('home')" class="active">Home</button>
  <button onclick="showPage('standings')">Standings</button>
  <button onclick="showPage('matchups')">Matchups</button>
  <button onclick="showPage('transactions')">Transactions</button>
  <button onclick="showPage('playoffs')">Playoffs</button>
  <button onclick="showPage('trending')">Trending</button>
</nav>
<main>
<div id="home" class="page">
  <div class="section-title">Latest Winner</div>
  <div id="winner-box">Loading...</div>
  <div class="stats-grid" id="stats-grid"></div>
  <div class="section-title">Money Leaderboard</div>
  <div class="card">
    <table id="money-leaderboard">
      <thead>
        <tr><th>Rank</th><th>Team</th><th>Weekly Wins</th><th>Total Earnings</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>
<div id="standings" class="page" style="display:none">
  <div class="section-title">League Standings</div>
  <div class="card">
    <table id="standings-table">
      <thead>
        <tr><th>Rank</th><th>Team</th><th>Record</th><th>Points For</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>
<div id="matchups" class="page" style="display:none">
  <div class="section-title">Weekly Matchups</div>
  <div class="filter-container">
    <label for="matchup-week">Week:</label>
    <select id="matchup-week" onchange="filterMatchups()"><option value="all">All Weeks</option></select>
    <label for="matchup-team">Team:</label>
    <select id="matchup-team" onchange="filterMatchups()"><option value="all">All Teams</option></select>
  </div>
  <div class="card">
    <table id="matchups-table">
      <thead><tr><th>Week</th><th>Team 1</th><th>Team 2</th><th>Score</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>
<div id="transactions" class="page" style="display:none">
  <div class="section-title">Recent Transactions</div>
  <div class="filter-container">
    <label for="trans-week">Week:</label>
    <select id="trans-week" onchange="filterTransactions()"><option value="all">All Weeks</option></select>
  </div>
  <div class="card">
    <div id="transactions-list">Loading transactions...</div>
  </div>
</div>
<div id="playoffs" class="page" style="display:none">
  <div class="section-title">Playoff Bracket</div>
  <div class="card">
    <div id="playoff-bracket">Loading bracket...</div>
  </div>
</div>
<div id="trending" class="page" style="display:none">
  <div class="section-title">Trending Players</div>
  <div class="card">
    <div id="trending-players">Loading trending players...</div>
  </div>
</div>
<div id="last-updated"></div>
<div id="debug-info"></div>
</main>

<script>
const URL_CONFIG = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR-PpZGo5sHtSw1wlCMdp3hKtL2Mfsop80Au0lr_AiOorIIGX-34lQfq2ZmHNBJq46z5kvaJRBq_hNc/pub?gid=0&single=true&output=csv';
const URL_OWNERS = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR-PpZGo5sHtSw1wlCMdp3hKtL2Mfsop80Au0lr_AiOorIIGX-34lQfq2ZmHNBJq46z5kvaJRBq_hNc/pub?gid=1393036626&single=true&output=csv';
const URL_ROSTERS = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR-PpZGo5sHtSw1wlCMdp3hKtL2Mfsop80Au0lr_AiOorIIGX-34lQfq2ZmHNBJq46z5kvaJRBq_hNc/pub?gid=700134694&single=true&output=csv';
const URL_WEEKLY_MATCHUPS = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR-PpZGo5sHtSw1wlCMdp3hKtL2Mfsop80Au0lr_AiOorIIGX-34lQfq2ZmHNBJq46z5kvaJRBq_hNc/pub?gid=425633695&single=true&output=csv';
const URL_WEEKLY_BONUSES = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR-PpZGo5sHtSw1wlCMdp3hKtL2Mfsop80Au0lr_AiOorIIGX-34lQfq2ZmHNBJq46z5kvaJRBq_hNc/pub?gid=1704595399&single=true&output=csv';
const URL_TRANSACTIONS = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR-PpZGo5sHtSw1wlCMdp3hKtL2Mfsop80Au0lr_AiOorIIGX-34lQfq2ZmHNBJq46z5kvaJRBq_hNc/pub?gid=1937108615&single=true&output=csv';
const URL_PLAYOFF_MATCHUPS = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR-PpZGo5sHtSw1wlCMdp3hKtL2Mfsop80Au0lr_AiOorIIGX-34lQfq2ZmHNBJq46z5kvaJRBq_hNc/pub?gid=1805847431&single=true&output=csv';
const SLEEPER_PLAYERS_URL = 'https://api.sleeper.app/v1/players/nfl';
const SLEEPER_TRENDING_URL = 'https://api.sleeper.app/v1/players/nfl/trending/add?lookback_hours=24&limit=25';

let owners = {}, rosters = {}, bonuses = [], matchups = [], transactions = [], playoffMatchups = [], lastWeek = 17;
let rosterToOwner = {};
let sleeperPlayers = {};

function addDebug(msg) {
  console.log(msg);
  const el = document.getElementById('debug-info');
  if (el) el.textContent += msg + '\n';
}

function getPlayerName(id) {
  const p = sleeperPlayers[id];
  return p ? `${p.first_name || ''} ${p.last_name || ''}`.trim() : `Player ${id}`;
}

function getTeamName(owner) {
  if (!owner) return 'Unknown';
  const teamName = owner.team_name && owner.team_name.trim() ? owner.team_name.trim() : '';
  return teamName || `Team ${owner.display_name || 'Unknown'}`;
}

function getTeamInitials(name) {
  return name.split(' ').map(w => w[0]).join('').substring(0,2).toUpperCase();
}

function getTeamColor(name) {
  const colors = [['#00d4ff','#00ffbb'],['#ff6b6b','#ff8787'],['#4facfe','#00f2fe'],['#43e97b','#38f9d7'],['#fa709a','#fee140']];
  const hash = name.split('').reduce((a,c)=>a+c.charCodeAt(0),0);
  return colors[hash % colors.length];
}

function createTeamLogo(name) {
  const initials = getTeamInitials(name);
  const [c1,c2] = getTeamColor(name);
  return `<div class="team-logo" style="background:linear-gradient(135deg,${c1} 0%,${c2} 100%);">${initials}</div>`;
}

function csvToArray(csv) {
  const lines = csv.trim().split('\n');
  if (lines.length < 1) return [];
  const headers = lines[0].split(',').map(h => h.trim());
  return lines.slice(1).map(line => {
    const obj = {};
    const values = line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
    headers.forEach((h,i) => {
      let val = values[i] || '';
      obj[h] = val.replace(/^"|"$/g,'').trim();
    });
    return obj;
  });
}

async function loadSleeperPlayers() {
  try {
    const res = await fetch(SLEEPER_PLAYERS_URL);
    if (res.ok) {
      sleeperPlayers = await res.json();
      addDebug(`Loaded ${Object.keys(sleeperPlayers).length} players`);
    }
  } catch (e) { addDebug('Player load error: '+e.message); }
}

async function loadTrendingPlayers() {
  try {
    const res = await fetch(SLEEPER_TRENDING_URL);
    const data = await res.json();
    const container = document.getElementById('trending-players');
    if (!data?.length) {
      container.innerHTML = '<p style="text-align:center;opacity:0.7;">No trending players</p>';
      return;
    }
    let html = '<table style="width:100%"><thead><tr><th>Rank</th><th>Player</th><th>Pos</th><th>Team</th><th>Adds</th></tr></thead><tbody>';
    data.forEach((item,i) => {
      const p = sleeperPlayers[item.player_id] || {};
      const name = `${p.first_name||''} ${p.last_name||''}`.trim() || 'Unknown';
      html += `<tr><td><span class="rank-badge">${i+1}</span></td><td style="font-weight:600">${name}</td><td>${p.position||'N/A'}</td><td>${p.team||'N/A'}</td><td style="color:#00ffbb;font-weight:700">+${item.count}</td></tr>`;
    });
    container.innerHTML = html + '</tbody></table>';
  } catch (e) {
    document.getElementById('trending-players').innerHTML = '<p style="text-align:center;opacity:0.7;">Error loading trending</p>';
  }
}

async function loadData() {
  try {
    await loadSleeperPlayers();
    const [o,r,b,m,t,c,p] = await Promise.all([
      fetch(URL_OWNERS).then(r=>r.text()),
      fetch(URL_ROSTERS).then(r=>r.text()),
      fetch(URL_WEEKLY_BONUSES).then(r=>r.text()),
      fetch(URL_WEEKLY_MATCHUPS).then(r=>r.text()),
      fetch(URL_TRANSACTIONS).then(r=>r.text()),
      fetch(URL_CONFIG).then(r=>r.text()),
      fetch(URL_PLAYOFF_MATCHUPS).then(r=>r.text())
    ]);

    csvToArray(o).forEach(row => owners[row.owner_id] = {display_name:row.display_name, team_name:row.team_name});
    csvToArray(r).forEach(row => {
      rosters[row.owner_id] = row;
      if (row.roster_id) rosterToOwner[row.roster_id] = row.owner_id;
    });

    bonuses = csvToArray(b).map(row => ({...row, week:+row.week, points:+row.points, amount:+row.amount}));
    matchups = csvToArray(m).map(row => ({...row, week:+row.week, points:+row.points}));
    
    transactions = csvToArray(t).map(row => {
      const safeParse = (field) => {
        let str = row[field] || '';
        if (!str || str === 'null' || str.trim() === '' || str === '{}') {
          return (field === 'draft_picks' || field === 'waiver_budget') ? [] : {};
        }
        str = str.replace(/'/g, '"');
        str = str.replace(/""/g, '"');
        try {
          return JSON.parse(str);
        } catch (e) {
          addDebug(`JSON parse error in ${field} (week ${row.week || '?'}): ${str.substring(0,100)}...`);
          return (field === 'draft_picks' || field === 'waiver_budget') ? [] : {};
        }
      };
      return {
        week: +row.week || 0,
        type: row.type || 'unknown',
        roster_ids: row.roster_ids ? row.roster_ids.split(',').map(s => s.trim()) : [],
        created: +row.created || 0,
        adds: safeParse('adds'),
        drops: safeParse('drops'),
        draft_picks: safeParse('draft_picks'),
        waiver_budget: safeParse('waiver_budget')
      };
    }).filter(t => t.week > 0);

    playoffMatchups = csvToArray(p).map(row => ({
      week: +row.week,
      roster_id: row.roster_id,
      matchup_id: row.matchup_id,
      points: +row.points,
      round: +row.round
    }));

    const config = csvToArray(c);
    lastWeek = config.find(r=>r.Key==='LastProcessedWeek') ? Math.min(+config.find(r=>r.Key==='LastProcessedWeek').Value,17) : 17;

    document.getElementById('last-updated').textContent = `Data up to Week ${lastWeek} ‚Ä¢ ${new Date().toLocaleString()}`;

    populateWeekFilters();
    populateTeamFilter();

    loadHome();
    loadStandings();
    loadMatchups();
    loadTransactions();
    loadTrendingPlayers();
    loadPlayoffs();
  } catch (e) {
    addDebug('Load error: '+e.message);
  }
}

function populateWeekFilters() {
  const weeks = [...new Set([...matchups.map(m=>m.week), ...transactions.map(t=>t.week)])].sort((a,b)=>a-b);
  ['matchup-week','trans-week'].forEach(id => {
    const sel = document.getElementById(id);
    sel.innerHTML = '<option value="all">All Weeks</option>';
    weeks.forEach(w => {
      const opt = document.createElement('option');
      opt.value = w; opt.text = `Week ${w}`;
      sel.appendChild(opt);
    });
  });
}

function populateTeamFilter() {
  const sel = document.getElementById('matchup-team');
  sel.innerHTML = '<option value="all">All Teams</option>';
  Object.values(owners).sort((a,b)=>getTeamName(a).localeCompare(getTeamName(b))).forEach(o => {
    const opt = document.createElement('option');
    opt.value = getTeamName(o);
    opt.text = getTeamName(o);
    sel.appendChild(opt);
  });
}

function loadHome() {
  const latest = bonuses.sort((a,b)=>b.week-a.week)[0];
  const box = document.getElementById('winner-box');
  if (latest && owners[latest.owner_id]) {
    const o = owners[latest.owner_id];
    const team = getTeamName(o);
    box.innerHTML = `
      ${createTeamLogo(team)}
      <div style="display:flex;flex-direction:column;">
        <span style="font-size:1.1rem;opacity:0.8;">Latest High Score Winner</span>
        <span style="font-weight:700;font-size:1.6rem;">${team} (${o.display_name})</span>
        <span style="font-size:1.8rem;font-weight:800;margin-top:0.5rem;">${latest.points.toFixed(1)} points</span>
        <span style="opacity:0.8;">Week ${latest.week} ‚Ä¢ Won $${latest.amount}</span>
      </div>`;
  } else {
    box.textContent = 'No winners yet';
  }

  let hottest = null, hottestDiff = -Infinity;
  let coldest = null, coldestDiff = Infinity;

  Object.values(rosters).forEach(r => {
    const diff = r.wins - r.losses;
    const o = owners[r.owner_id] || {};
    const team = getTeamName(o);
    if (diff > hottestDiff) {
      hottestDiff = diff;
      hottest = team;
    }
    if (diff < coldestDiff) {
      coldestDiff = diff;
      coldest = team;
    }
  });

  const grid = document.getElementById('stats-grid');
  grid.innerHTML = `
    <div class="stat-card">
      <div style="font-size:2rem;margin-bottom:0.5rem;">${createTeamLogo(hottest || '‚Äî')}</div>
      <div class="stat-value" style="font-size:1.5rem;">${hottest || '‚Äî'}</div>
      <div class="stat-label">Hottest Team</div>
    </div>
    <div class="stat-card">
      <div style="font-size:2rem;margin-bottom:0.5rem;">${createTeamLogo(coldest || '‚Äî')}</div>
      <div class="stat-value" style="font-size:1.5rem;">${coldest || '‚Äî'}</div>
      <div class="stat-label">Coldest Team</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">${lastWeek}</div>
      <div class="stat-label">Weeks Played</div>
    </div>
  `;

  const money = {};
  Object.keys(owners).forEach(id => money[id] = {wins:0, total:0, owner:owners[id]});
  bonuses.forEach(b => {
    if (money[b.owner_id]) {
      money[b.owner_id].total += b.amount;
      money[b.owner_id].wins += 1;
    }
  });
  const lb = Object.values(money).sort((a,b)=>b.wins-a.wins || b.total-a.total);
  const tbody = document.querySelector('#money-leaderboard tbody');
  tbody.innerHTML = '';
  lb.forEach((e,i) => {
    const team = getTeamName(e.owner);
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><span class="rank-badge ${i<3?'rank-'+(i+1):''}">${i+1}</span></td>
      <td><div class="team-cell">${createTeamLogo(team)}<div class="team-info"><span class="team-name">${team}</span><span class="owner-name">${e.owner.display_name}</span></div></div></td>
      <td>${e.wins}</td>
      <td style="font-weight:700;font-size:1.1rem;">$${e.total}</td>
    `;
    tbody.appendChild(tr);
  });
}

function loadStandings() {
  const data = Object.values(rosters).sort((a,b)=>(b.wins-a.wins)||(b.points_for-a.points_for));
  const tbody = document.querySelector('#standings-table tbody');
  tbody.innerHTML = '';
  data.forEach((r,i) => {
    const o = owners[r.owner_id] || {};
    const team = getTeamName(o);
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><span class="rank-badge ${i<3?'rank-'+(i+1):''}">${i+1}</span></td>
      <td><div class="team-cell">${createTeamLogo(team)}<div class="team-info"><span class="team-name">${team}</span><span class="owner-name">${o.display_name}</span></div></div></td>
      <td style="font-weight:600;">${r.wins}-${r.losses}${r.ties>0?'-'+r.ties:''}</td>
      <td style="font-weight:700;">${(+r.points_for).toFixed(2)}</td>
    `;
    tbody.appendChild(tr);
  });
}

function loadMatchups(w='all', team='all') {
  const tbody = document.querySelector('#matchups-table tbody');
  tbody.innerHTML = '';
  const pairs = {};
  matchups.forEach(m => {
    const key = `${m.week}-${m.matchup_id}`;
    pairs[key] = pairs[key] || [];
    pairs[key].push(m);
  });
  Object.values(pairs).forEach(pair => {
    if (pair.length !== 2) return;
    const week = pair[0].week;
    if (w !== 'all' && week != +w) return;
    const t1 = owners[rosterToOwner[pair[0].roster_id]] || {};
    const t2 = owners[rosterToOwner[pair[1].roster_id]] || {};
    const n1 = getTeamName(t1), n2 = getTeamName(t2);
    if (team !== 'all' && n1 !== team && n2 !== team) return;
    const s1 = pair[0].points, s2 = pair[1].points;
    const win = s1 > s2 ? 0 : s2 > s1 ? 1 : -1;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td style="font-weight:700;">Week ${week}</td>
      <td><div class="team-cell">${createTeamLogo(n1)}<span class="team-name" style="opacity:${win===0?1:0.6}">${n1}</span></div></td>
      <td><div class="team-cell">${createTeamLogo(n2)}<span class="team-name" style="opacity:${win===1?1:0.6}">${n2}</span></div></td>
      <td>
        <span style="color:${win===0?'#00ffbb':'rgba(255,255,255,0.6)'}">${s1.toFixed(2)}</span> -
        <span style="color:${win===1?'#00ffbb':'rgba(255,255,255,0.6)'}">${s2.toFixed(2)}</span>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function loadTransactions(filter='all') {
  const container = document.getElementById('transactions-list');
  container.innerHTML = '<p style="text-align:center;opacity:0.7;">Loading...</p>';
  const filtered = transactions
    .filter(t => filter === 'all' || t.week == +filter)
    .sort((a,b) => b.created - a.created || b.week - a.week);
  if (!filtered.length) {
    container.innerHTML = '<p style="text-align:center;opacity:0.7;padding:2rem;">No transactions found</p>';
    return;
  }
  container.innerHTML = '';
  let currentWeek = null, weekDiv = null;
  filtered.forEach(t => {
    const type = t.type.toLowerCase();
    const badgeClass = type === 'trade' ? 'transaction-trade' : 'transaction-free_agent';
    const typeText = type === 'free_agent' ? 'FREE AGENT' : type === 'waiver' ? 'WAIVER' : type.toUpperCase();
    const date = t.created ? new Date(t.created) : null;
    const dateStr = date ? `<div style="font-size:0.85rem;opacity:0.7;margin-top:0.5rem;">${date.toLocaleDateString('en-US',{month:'short',day:'numeric'})}</div>` : '';
    const teamsHtml = t.roster_ids.map(rid => {
      const oid = rosterToOwner[rid] || '';
      const o = owners[oid] || {display_name:'Unknown'};
      const name = getTeamName(o);
      return `<div class="team-cell" style="display:inline-flex;gap:0.75rem;align-items:center;">${createTeamLogo(name)}<span class="team-name">${name}</span></div>`;
    }).join(type==='trade' ? '<span style="font-size:1.8rem;opacity:0.6;margin:0 1rem;">‚Üî</span>' : '<span style="margin:0 0.5rem;">‚Ä¢</span>');
    let details = [];
    Object.keys(t.adds).forEach(pid => details.push(`<span style="color:#00ffbb;font-weight:700;">+ ${getPlayerName(pid)}</span>`));
    Object.keys(t.drops).forEach(pid => details.push(`<span style="color:#ff6b6b;font-weight:700;">‚Äì ${getPlayerName(pid)}</span>`));
    t.draft_picks.forEach(p => {
      const from = getTeamName(owners[rosterToOwner[p.previous_owner_id || p.roster_id] || {}]);
      const to = getTeamName(owners[rosterToOwner[p.owner_id] || {}]);
      details.push(`<strong>${from} ‚Üí ${to}</strong>: ${p.season} Round ${p.round}`);
    });
    t.waiver_budget.forEach(b => {
      const sender = getTeamName(owners[rosterToOwner[b.sender] || {}]);
      const receiver = getTeamName(owners[rosterToOwner[b.receiver] || {}]);
      details.push(`<strong>${sender}</strong> sends $${b.amount} FAAB ‚Üí <strong>${receiver}</strong>`);
    });
    if (!details.length) details = ['<span style="opacity:0.6;">No movement recorded</span>'];
    if (t.week !== currentWeek) {
      currentWeek = t.week;
      weekDiv = document.createElement('div');
      weekDiv.innerHTML = `<h3 style="font-size:1.5rem;margin:2rem 0 1rem;color:#00d4ff;border-bottom:2px solid #00d4ff;padding-bottom:0.5rem;">Week ${currentWeek}</h3>`;
      container.appendChild(weekDiv);
    }
    const card = document.createElement('div');
    card.style = 'background:rgba(255,255,255,0.08);backdrop-filter:blur(20px);border-radius:16px;padding:1.5rem;margin-bottom:1rem;border:1px solid rgba(255,255,255,0.15);';
    card.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;">
        <div style="display:flex;align-items:center;flex-wrap:wrap;gap:1rem;">${teamsHtml}</div>
        <div style="text-align:right;">
          <span class="transaction-badge ${badgeClass}">${typeText}</span>
          ${dateStr}
        </div>
      </div>
      <div style="margin-top:1.2rem;line-height:1.8;font-size:1.05rem;">${details.join('<br>')}</div>
    `;
    weekDiv.appendChild(card);
  });
}

function getPlayoffPairs(week) {
  const weekData = playoffMatchups.filter(m => m.week === week);
  const pairs = {};
  weekData.forEach(m => {
    pairs[m.matchup_id] = pairs[m.matchup_id] || [];
    pairs[m.matchup_id].push(m);
  });
  return Object.values(pairs).map(pair => {
    if (pair.length < 2) return null;
    const teams = pair.map(p => ({
      roster_id: p.roster_id,
      name: getTeamName(owners[rosterToOwner[p.roster_id]] || {display_name:'Unknown'}),
      points: p.points.toFixed(1),
      logo: createTeamLogo(getTeamName(owners[rosterToOwner[p.roster_id]] || {display_name:'Unknown'}))
    }));
    const winner = teams[0].points > teams[1].points ? teams[0] : teams[1].points > teams[0].points ? teams[1] : null;
    return {teams, winner};
  }).filter(p => p);
}

function renderMatchup(matchup, isChamp = false) {
  if (!matchup || matchup.teams.length < 2) {
    return '<div class="matchup-box"><div style="text-align:center;padding:3rem;opacity:0.6;">TBD / Bye</div></div>';
  }
  const t1 = matchup.teams[0], t2 = matchup.teams[1];
  return `
    <div class="matchup-box ${matchup.winner ? 'winner-border' : ''} ${isChamp ? 'champ' : ''}">
      <div class="matchup-team ${matchup.winner === t1 ? 'win' : 'loss'}">
        ${t1.logo}
        <div>
          <div style="font-weight:700;font-size:1.2rem;">${t1.name}</div>
          <div style="font-size:1.6rem;color:#00ffbb;font-weight:800;">${t1.points}</div>
        </div>
      </div>
      <div class="vs">VS</div>
      <div class="matchup-team ${matchup.winner === t2 ? 'win' : 'loss'}">
        ${t2.logo}
        <div>
          <div style="font-weight:700;font-size:1.2rem;">${t2.name}</div>
          <div style="font-size:1.6rem;color:#00ffbb;font-weight:800;">${t2.points}</div>
        </div>
      </div>
    </div>
  `;
}

function loadPlayoffs() {
  const bracket = document.getElementById('playoff-bracket');

  // Check if there is any playoff data
  if (playoffMatchups.length === 0) {
    bracket.innerHTML = `
      <div class="playoff-message">
        <div style="font-size:5rem;opacity:0.3;margin-bottom:1rem;">üèÜ</div>
        <div style="font-size:2.5rem;font-weight:700;color:#00ffbb;">No Playoff Data Available Yet</div>
        <div style="margin-top:1rem;opacity:0.7;font-size:1.2rem;">Playoffs will appear here once Week 15 begins</div>
      </div>
    `;
    return;
  }

  if (lastWeek < 15) {
    bracket.innerHTML = `
      <div class="playoff-message">
        <div style="font-size:5rem;opacity:0.3;margin-bottom:1rem;">üèÜ</div>
        <div style="font-size:3rem;font-weight:700;color:#00ffbb;">Season In Progress</div>
        <div style="margin-top:1rem;opacity:0.7;font-size:1.4rem;">Playoffs begin in Week 15</div>
      </div>
    `;
    return;
  }

  let html = '<div class="playoff-container">';

  // Quarterfinals
  html += '<div class="playoff-section"><h2>Quarterfinals (Week 15)</h2><div class="playoff-grid">';
  const qf = getPlayoffPairs(15);
  if (qf.length === 0) html += '<div class="matchup-box"><div style="text-align:center;padding:3rem;opacity:0.6;">No matches yet</div></div>';
  qf.forEach(m => html += renderMatchup(m));
  html += '</div></div>';

  // Semifinals
  html += '<div class="playoff-section"><h2>Semifinals (Week 16)</h2><div class="playoff-grid">';
  const sf = getPlayoffPairs(16);
  if (sf.length === 0) html += '<div class="matchup-box"><div style="text-align:center;padding:3rem;opacity:0.6;">No matches yet</div></div>';
  sf.forEach(m => html += renderMatchup(m));
  html += '</div></div>';

  // Championship
  html += '<div class="playoff-section"><h2>Championship (Week 17)</h2><div class="playoff-grid">';
  const champ = getPlayoffPairs(17);
  if (champ.length === 0) {
    html += '<div class="matchup-box champ"><div style="text-align:center;padding:4rem;opacity:0.6;">Championship TBD</div></div>';
  } else {
    html += renderMatchup(champ[0], true);
    if (lastWeek >= 17 && champ[0].winner) {
      html += `<div class="champion-banner">üèÜ CHAMPION: ${champ[0].winner.name} üèÜ</div>`;
    }
  }
  html += '</div></div>';

  if (lastWeek >= 17) {
    html += '<div style="text-align:center;margin-top:4rem;"><h2 style="font-size:4rem;color:#FFD700;text-shadow:0 0 40px gold;">SEASON ENDED</h2></div>';
  }

  bracket.innerHTML = html;
}

function filterMatchups() {
  loadMatchups(document.getElementById('matchup-week').value, document.getElementById('matchup-team').value);
}

function filterTransactions() {
  loadTransactions(document.getElementById('trans-week').value);
}

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
  document.getElementById(id).style.display = 'block';
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.querySelector(`nav button[onclick="showPage('${id}')"]`).classList.add('active');
  if (id === 'playoffs') loadPlayoffs();
}

window.onload = loadData;
</script>
</body>
</html>
