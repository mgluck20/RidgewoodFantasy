<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sleeper Fantasy League Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .section { margin-bottom: 2rem; }
    .card { @apply bg-white shadow-md rounded-2xl p-4 mb-4; }
    .header { @apply text-xl font-bold mb-2; }
    .table th, .table td { @apply px-4 py-2 border-b border-gray-200; }
    .highlight { @apply bg-green-100 font-bold; }
    .winner { @apply bg-yellow-100 font-bold; }
  </style>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-7xl mx-auto">
    <header class="mb-8">
      <h1 class="text-4xl font-extrabold text-gray-800">üèà Sleeper Fantasy League Dashboard</h1>
      <p class="text-gray-600 mt-2">Live standings, leaders, and transactions for your league</p>
    </header>

    <!-- MONEY LEADERBOARD -->
    <section class="section" id="money-leaderboard">
      <div class="card">
        <h2 class="header">üí∞ Money Leaderboard</h2>
        <table class="table w-full text-left">
          <thead>
            <tr class="bg-gray-200">
              <th>Rank</th>
              <th>Owner</th>
              <th>Team</th>
              <th>Total Bonuses</th>
              <th>Weekly Wins</th>
            </tr>
          </thead>
          <tbody id="leaderboard-body">
            <tr><td colspan="5" class="text-center py-4">Loading leaderboard...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- LEAGUE STANDINGS -->
    <section class="section" id="league-standings">
      <div class="card">
        <h2 class="header">üìä League Standings</h2>
        <table class="table w-full text-left">
          <thead>
            <tr class="bg-gray-200">
              <th>Rank</th>
              <th>Owner</th>
              <th>Team</th>
              <th>W</th>
              <th>L</th>
              <th>T</th>
              <th>Points For</th>
              <th>Points Against</th>
              <th>Win %</th>
            </tr>
          </thead>
          <tbody id="standings-body">
            <tr><td colspan="9" class="text-center py-4">Loading standings...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- WEEKLY HIGH SCORERS -->
    <section class="section" id="weekly-winners">
      <div class="card">
        <h2 class="header">üèÜ Weekly High Score Winners</h2>
        <table class="table w-full text-left">
          <thead>
            <tr class="bg-gray-200">
              <th>Week</th>
              <th>Owner</th>
              <th>Team</th>
              <th>Points</th>
              <th>Bonus</th>
            </tr>
          </thead>
          <tbody id="weekly-winners-body">
            <tr><td colspan="5" class="text-center py-4">Loading weekly winners...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- RECENT TRANSACTIONS -->
    <section class="section" id="recent-transactions">
      <div class="card">
        <h2 class="header">üìù Recent Transactions</h2>
        <table class="table w-full text-left">
          <thead>
            <tr class="bg-gray-200">
              <th>Week</th>
              <th>Type</th>
              <th>Status</th>
              <th>Rosters Involved</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="transactions-body">
            <tr><td colspan="5" class="text-center py-4">Loading transactions...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- WEEKLY MATCHUPS (optional expand/collapse) -->
    <section class="section" id="weekly-matchups">
      <div class="card">
        <h2 class="header">üìÖ Weekly Matchups</h2>
        <div id="matchups-container">
          <p class="text-center py-4">Matchups will appear here.</p>
        </div>
      </div>
    </section>
  </div>

  <script>
    // =====================
    // DATA FETCH FUNCTIONS
    // =====================

    function loadLeaderboard() {
      google.script.run.withSuccessHandler(data => {
        const tbody = document.getElementById('leaderboard-body');
        tbody.innerHTML = '';
        if (data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">No data</td></tr>';
          return;
        }
        data.forEach(entry => {
          tbody.innerHTML += `<tr class='${entry.total_bonuses > 0 ? "highlight" : ""}'>
            <td>${entry.rank}</td>
            <td>${entry.display_name}</td>
            <td>${entry.team_name}</td>
            <td>$${entry.total_bonuses}</td>
            <td>${entry.wins}</td>
          </tr>`;
        });
      }).getMoneyLeaderboard();
    }

    function loadStandings() {
      google.script.run.withSuccessHandler(data => {
        const tbody = document.getElementById('standings-body');
        tbody.innerHTML = '';
        if (data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="9" class="text-center py-4">No data</td></tr>';
          return;
        }
        data.forEach(entry => {
          tbody.innerHTML += `<tr>
            <td>${entry.rank}</td>
            <td>${entry.display_name}</td>
            <td>${entry.team_name}</td>
            <td>${entry.wins}</td>
            <td>${entry.losses}</td>
            <td>${entry.ties}</td>
            <td>${entry.points_for.toFixed(2)}</td>
            <td>${entry.points_against.toFixed(2)}</td>
            <td>${(entry.win_pct*100).toFixed(1)}%</td>
          </tr>`;
        });
      }).getLeagueStandings();
    }

    function loadWeeklyWinners() {
      google.script.run.withSuccessHandler(data => {
        const tbody = document.getElementById('weekly-winners-body');
        tbody.innerHTML = '';
        if (data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">No weekly winners yet</td></tr>';
          return;
        }
        data.forEach(entry => {
          tbody.innerHTML += `<tr class='winner'>
            <td>${entry.week}</td>
            <td>${entry.display_name}</td>
            <td>${entry.team_name}</td>
            <td>${entry.points}</td>
            <td>$${entry.amount}</td>
          </tr>`;
        });
      }).getAllWeeklyWinners();
    }

    function loadTransactions() {
      google.script.run.withSuccessHandler(data => {
        const tbody = document.getElementById('transactions-body');
        tbody.innerHTML = '';
        if (data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4">No transactions yet</td></tr>';
          return;
        }
        data.forEach(t => {
          const date = new Date(t.timestamp).toLocaleDateString();
          tbody.innerHTML += `<tr>
            <td>${t.week}</td>
            <td>${t.type}</td>
            <td>${t.status}</td>
            <td>${t.roster_count}</td>
            <td>${date}</td>
          </tr>`;
        });
      }).getRecentTransactions(20);
    }

    function loadMatchups() {
      // Optional: implement getWeeklyMatchups() in code.gs if desired
      const container = document.getElementById('matchups-container');
      container.innerHTML = '<p class="text-center py-4">Matchups not yet implemented.</p>';
    }

    // =====================
    // INITIAL LOAD
    // =====================
    loadLeaderboard();
    loadStandings();
    loadWeeklyWinners();
    loadTransactions();
    loadMatchups();

  </script>
</body>
</html>
